# Jira 貼り付け用：MVP タスク一覧（Epic → Task）

> 目的：v0 で作成済みの画面モックを、MVP（IndexedDB 永続化）で動くプロダクトにするための実装タスク一覧  
> 永続化：MVP = IndexedDB / 将来 = Supabase（Repository 層で抽象化）

---

## EPIC A：基盤・開発環境

- A1. Next.js プロジェクト初期セットアップ（yarn / eslint / tsconfig / tailwind）
- A2. shadcn/ui セットアップ・共通 UI（Button/Card/Toast 等）整備
- A3. ルーティング骨格作成（/plans, /plans/new, /plans/[id] … 全画面の空ページ作成）
- A4. 共通レイアウト（ヘッダー/パンくず/ナビ）実装
- A5. 共通フォーマット関数（円表示、%表示、年月表示）実装
- A6. エラーハンドリング方針（ErrorBoundary / not-found / toast）実装
- A7. 開発用モックデータ生成ユーティリティ実装（seed）

---

## EPIC B：データ層（IndexedDB）＋将来 Supabase 移行の下地

- B1. ドメインモデル定義（TypeScript 型：Plan/Version/MonthlyRecord/LifeEvent/HousingAssumptions）
- B2. IndexedDB スキーマ設計（objectStore・index・versioning）
- B3. IndexedDB ラッパー実装（CRUD 共通：get/put/delete/list/tx）
- B4. Repository インターフェース定義（PlanRepo/MonthlyRepo/EventRepo/HousingRepo/VersionRepo）
- B5. IndexedDB Repository 実装（全 Repo）
- B6. 将来 Supabase 用 Repository のスタブ作成（interface 準拠、未接続で OK）
- B7. データマイグレーション基盤（IndexedDB schema version upgrade 処理）
- B8. テスト用 in-memory Repository（ユニットテストで使用）

---

## EPIC C：プラン管理（一覧・作成・基本設定）

- C1. プラン一覧：IndexedDB 連携（list/search/filter/archive）
- C2. プラン作成ウィザード：保存処理（create plan + 初期 version 作成）
- C3. プラン作成：初期デフォルト前提投入（3 シナリオ、住宅 4 タイプの初期前提）
- C4. プラン複製（plan + versions + assumptions の複製）
- C5. プランアーカイブ/復元
- C6. プラン削除（確認ダイアログ・関連データ削除）
- C7. プラン設定（前提：昇給/インフレ/利回り）編集画面の実装

---

## EPIC D：ダッシュボード（集計・導線の実装）

- D1. ダッシュボード：プラン基本情報の表示（plan/currentVersion）
- D2. ダッシュボード：今月ステータス判定（未入力/入力済み）
- D3. ダッシュボード：今月の収支・残高カード（MonthlyRecord から集計）
- D4. ダッシュボード：次にやることチェックリスト（未入力・イベント未登録等の判定）
- D5. ダッシュボード：住宅 LCC サマリーカード（選択中タイプ＋合計/概算）
- D6. ダッシュボード：直近イベント表示（次の 3 件）
- D7. ダッシュボード：シナリオ切替の状態管理（URL クエリ or local state）
- D8. ダッシュボード：空状態（初回）分岐

---

## EPIC E：月次（かんたん入力・一覧・詳細）

- E1. 月次一覧：年選択・状態フィルタ（未入力/入力済み）＋ IndexedDB 連携
- E2. 月次一覧：当月ハイライト・行アクション（入力/編集/詳細/複製/削除）
- E3. 月次かんたん入力：対象月の読み込み・保存（upsert）
- E4. 月次かんたん入力：前月コピー機能
- E5. 月次かんたん入力：収支自動計算表示（income-expense）
- E6. 月次詳細：内訳行の CRUD（incomeItems/expenseItems）
- E7. 月次詳細：カテゴリ選択・固定/変動の扱い（MVP 仕様に合わせて）
- E8. 月次詳細：合計整合（内訳合計 vs かんたん合計）差分表示
- E9. 月次詳細：合計上書き／差額を「その他」に吸収アクション
- E10. 月次削除（confirm）＋関連内訳削除

---

## EPIC F：ライフイベント（一覧・作成/編集）

- F1. イベント一覧：IndexedDB 連携（今後/過去/すべて、種別、単発/毎月）
- F2. イベント作成：入力バリデーション（必須項目、金額>0、期間>=1）
- F3. イベント作成：保存（create）
- F4. イベント編集：読み込み・更新（update）
- F5. イベント複製
- F6. イベント削除（confirm）
- F7. イベントプレビュー（単発/毎月の反映イメージ、総額概算）

---

## EPIC G：住宅 LCC（比較トップ・前提編集・計算）

- G1. 住宅 LCC 比較トップ：4 タイプの表示（Repo 連携）
- G2. 住宅タイプ選択（is_selected 更新）＋ダッシュボード反映
- G3. 住宅 LCC 比較：horizon（30/35/40 年）切替
- G4. 住宅 LCC 比較：簡易チャート（バー/スタック）実装
- G5. 住宅前提編集：タブ（4 タイプ）＋ かんたん/詳細 切替
- G6. 住宅前提編集：プリセット適用（標準/保守/楽観）※MVP 用の固定値で OK
- G7. 住宅前提編集：タイプ固有入力（マンション：管理費/修繕積立/一時金、賃貸：家賃/更新料/上昇率等）
- G8. 住宅前提編集：修繕スケジュール（繰り返し行 UI）
- G9. LCC 計算モジュール実装（内訳：初期/ローン or 家賃/税/修繕 or 管理/光熱）
- G10. LCC 計算：前提変更プレビュー（右カラムの概算更新）
- G11. LCC 結果の保存方針（都度計算 or snapshot 保存）決定＆実装（MVP は都度計算で OK）
- G12. LCC の注意喚起（概算・前提依存）UI 実装

---

## EPIC H：バージョン管理（改定履歴・差分）

- H1. 現行 Version の決定ロジック（is_current の整合）
- H2. 改定履歴一覧：list 表示（version_no / change_note / created_at）
- H3. 新バージョン作成：現行の前提を複製して新 version 生成
- H4. 差分表示（簡易）：前提パラメータ差分（シナリオ・住宅前提・イベントの差分）
- H5. 差分表示：主要 KPI 差分（LCC 合計、選択住宅タイプ、イベント件数など）
- H6. 新バージョンを現行に反映（is_current 切替）
- H7. バージョン削除（現行版は削除不可等の制約）

---

## EPIC I：将来見通し（簡易）

- I1. 将来推移（簡易）画面の土台（/forecast）※モックでも OK
- I2. 将来推移：月次実績＋イベント＋前提からの簡易投影（最低限の概算ロジック）
- I3. シナリオ切替で再計算（保守/標準/楽観）
- I4. ダッシュボードのミニ見通しカードに反映

---

## EPIC J：品質・運用

- J1. Zod 等による入力スキーマ（Plan/Monthly/Event/Housing）導入（任意だが強推奨）
- J2. ユニットテスト（計算：LCC、収支、イベント反映）
- J3. E2E/画面テスト最小（主要導線：作成 → 月次入力 →LCC→ イベント → 改定）
- J4. パフォーマンス（IndexedDB アクセスの最適化・メモ化）
- J5. リリース用ビルド確認（lint/typecheck/build）
- J6. README（ローカル起動、IndexedDB 注意、データ初期化方法）

---

## EPIC K：IndexedDB 運用ユーティリティ（MVP で便利）

- K1. デバッグ用「データ初期化」ボタン（開発モードのみ）
- K2. データエクスポート（JSON ダウンロード）※将来移行に有効
- K3. データインポート（JSON アップロード）※任意

---

## Risks（リスク）

- IndexedDB スキーマ変更の手戻り → B7（マイグレーション）を早めに実装して耐性を付ける
- 住宅 LCC の前提が複雑化 → かんたんプリセット優先、詳細は段階開放
- バージョン差分が肥大化 → MVP は 前提差分＋主要 KPI 差分 で止める

## 追加開発候補

- 売却/住替え（任意）を add-on として追加
- 割引現在価値（NPV）対応（discountRate）
- 税モデル精緻化（地域差/控除）
