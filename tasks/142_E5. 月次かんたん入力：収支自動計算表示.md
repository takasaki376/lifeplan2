# Jira チケット（E5）月次かんたん入力：収支自動計算表示（income-expense）

## Summary

E5. 月次かんたん入力：収支自動計算表示（income - expense）

## Issue Type

Task（または Story）

## Priority

Medium（入力の体験改善／ミス防止）

## Background / Context

月次かんたん入力では、収入合計と支出合計を入力する。入力中に収支（差分）が見えると、
入力ミス（桁/符号）に気づきやすく、ダッシュボード（D3）とも整合する。

MVP では詳細内訳は未実装/後続のため、E5 は「表示上の自動計算」に限定して導入する。

## Goal

- 収入/支出の入力に連動して、収支（income-expense）がリアルタイムに表示される
- 収支のプラス/マイナスが色やラベルで分かる（任意だが推奨）
- 未入力時の表示（—）が統一される
- 保存処理（E3）を壊さない（net は保存しなくて良い）

---

## In Scope

- 月次かんたん入力画面（current / 指定月）の UI に「収支」表示枠を追加（または既存枠にロジック追加）
- 入力値の変化に応じた収支の自動計算
- 表示フォーマット（A5 の formatYen）適用
- プラス/マイナスの視覚表現（色・バッジ）
- 入力パース（カンマ入り）対応が必要なら共通 util（A5 parseYenInput）を使用（任意）

## Out of Scope

- 収支を DB に保存する（不要）
- 詳細内訳から合計を自動集計する（E6 以降）
- イベント反映による自動増減（I2）
- 前月比などの追加指標

---

## Functional Requirements

### 1) 自動計算

- income = `incomeTotalYen`（未入力は undefined）
- expense = `expenseTotalYen`（未入力は undefined）
- 表示用 net：
  - 両方入力がある場合：`net = income - expense`
  - 片方のみ入力：未確定扱い（推奨：`—`）
  - 両方未入力：`—`

※MVP は「未入力の片方を 0 扱い」でも良いが、誤解を避けるため `—` 推奨。

### 2) 表示

- `収支（自動計算）` を明示
- 表示値：
  - `formatYen(net)`（A5）
- 視覚表現（任意だが推奨）
  - net >= 0：success（緑系）
  - net < 0：destructive（赤系）
- 補足（任意）
  - `※収入合計 - 支出合計`

### 3) 保存との関係

- 保存（E3）では income/expense/資産/負債のみ保存
- net は保存しない（画面表示のみ）
- ただし、入力欄の値は保存前に number に正規化されていること（E3 の方針に従う）

### 4) 入力パース（任意）

- 入力が文字列で管理されている場合：
  - `parseYenInput("1,234") => 1234`
- パースに失敗したらそのフィールドにエラー表示（軽微なら toast 不要）
- ただし E5 自体は「表示」を目的にするため、バリデーション強化は最小で OK

---

## UI Requirements

- v0 モックに沿って、入力ブロックの下または右側に「収支」サマリーを表示
- ローディング時（既存読み込み中）は収支も Skeleton
- モバイルで見切れない（1 行表示＋折返し）

---

## Technical Notes

- `"use client"`
- React state：
  - income/expense はフォーム state から取得（watch）
  - net は `useMemo` で計算（income/expense 依存）
- util（A5）：
  - `formatYen`
  - `parseYenInput`（任意）

---

## Acceptance Criteria

- [ ] 収入合計と支出合計を入力すると、収支がリアルタイムに更新される
- [ ] 収支が正/負で見た目が切り替わる（任意だが推奨）
- [ ] 未入力時は `—` 表示となり、誤解を招かない
- [ ] 保存（E3）を実行しても動作が壊れない（net は保存しない）
- [ ] 金額表示が共通フォーマット（A5）で整形される
- [ ] lint/typecheck が通る

## Definition of Done

- [ ] PR 作成＆レビュー完了
- [ ] 手動テスト手順が PR に記載（未入力/片側のみ/両方入力/マイナス）
- [ ] lint/typecheck が通る

---

## Dependencies

- E3（月次かんたん入力：読み込み・保存）
- A5（formatYen：推奨）

## Follow-ups（関連チケット）

- E6. 月次詳細内訳入力（内訳から合計自動集計する場合の方針策定）
- D3. ダッシュボード収支カード（同じロジックで表示）
