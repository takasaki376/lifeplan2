# Jira チケット（F2）イベント作成：入力バリデーション（必須項目、金額>0、期間>=1）

## Summary

F2. イベント作成：入力バリデーション（必須項目、金額>0、期間>=1）

## Issue Type

Task（または Story）

## Priority

High

## Background / Context

v0 でイベント作成画面 UI は作成済み。MVP ではまず「入力ミスを防ぎ、保存の成功率を上げる」ために、
保存前の入力バリデーションを実装する。

イベントは将来見通しや月次の反映に影響するため、最低限の整合性（必須・金額・期間）を担保する。

## Goal

- 必須項目が未入力の場合、保存をブロックし、エラーを分かりやすく表示する
- 金額が 0 以下の場合、保存をブロックする
- 毎月イベントの期間は `durationMonths >= 1` を保証する
- バリデーションは編集画面でも再利用できる形にする（関数 or schema）

---

## In Scope

- イベント作成画面（/plans/[planId]/events/new）の入力検証
- エラー表示（フィールド下のメッセージ、フォーム上部サマリーは任意）
- 保存ボタンの disabled 制御（任意だが推奨）
- バリデーションの共通化（`validateLifeEventDraft()` など）
- `endMonth` は入力フィールドではなく、`startYm` + `durationMonths` からの read-only 表示

## Out of Scope

- IndexedDB への保存（F3）
- 編集画面への適用（F4 で再利用するが、適用作業は F4 でも OK）
- 高度な検証（開始月<終了月、インフレ連動など）は MVP 外（ただし軽く入れるのは OK）
- Zod 導入の本格化（J1）

---

## Validation Rules（仕様）

### 必須項目（Required）

以下が未入力の場合、エラー：

- イベント名（title）
  - ただし MVP の設計次第で「title 必須」or「title 未入力なら eventType で代替」も可能
  - 本チケットでは **title 必須** とする（一覧の視認性重視）
- 発生月（startYm）
- 金額（amountYen）
- 収支区分（direction）：`expense | income`
- 形態（cadence）：`once | monthly`

### 金額

- `amountYen > 0`
- 入力は `type="number"` 前提（カンマ除去は必須対応にしない）
- 数値化できなければエラー
- 端数（小数）は MVP では不可（整数円）推奨

### 期間（毎月イベントのみ）

- cadence = `monthly` の場合：
  - `durationMonths` 必須（整数）かつ `>= 1`
- cadence = `once` の場合：
  - `durationMonths = 1` をセット（入力値は持たない）

### 追加の軽量チェック（任意・推奨）

- startYm の形式が `YYYY-MM` であること
- `endMonth` は表示のみ（`startYm` + `durationMonths - 1` の計算値）

---

## UX / Error Display

- フィールド単位のエラー表示（Input の下に赤字）
- 保存ボタン押下時に全エラーを表示（初回から全部赤くしない）
- 保存ボタン disabled 条件（任意だが推奨）：
  - 必須が揃っておらず、またはエラーがある場合 disabled
- toast は任意（バリデーションはフィールド表示が基本）

---

## Deliverables

- `src/lib/validation/lifeEvent.ts`（例）
  - `validateLifeEventDraft(draft): { valid: boolean; errors: Record<string,string> }`
- イベント作成画面に適用
  - 保存前に validate し、エラーがあれば保存処理を呼ばない

---

## Acceptance Criteria

- [ ] 必須項目未入力で保存できない（エラー表示される）
- [ ] 金額が 0 または負数で保存できない（エラー表示される）
- [ ] 毎月イベントで期間が 1 未満なら保存できない（エラー表示される）
- [ ] cadence が単発のとき、`durationMonths` は 1 で固定される
- [ ] エラーが解消されたら保存ボタンが有効になり得る（disabled 運用する場合）
- [ ] lint/typecheck が通る

## Definition of Done

- [ ] PR 作成＆レビュー完了
- [ ] 手動テスト手順が PR に記載（必須未入力/金額 0/期間 0/正常系）
- [ ] lint/typecheck が通る

---

## Dependencies

- なし（F3 の保存ロジック前でも実装可能）
- （推奨）A5（入力を text にする場合のみ、円入力のパース補助があると良い）

## Follow-ups（関連チケット）

- F3. イベント作成：保存（create）
- F4. イベント編集：更新（update）※同バリデーションを再利用
- J1. Zod 等の入力スキーマ導入（厳密化）
