## 1) Decision（確定事項）

1. **既存実装は“土台として活かす”が、チェックリストカードの UI/ロジックは仕様に合わせて置換・整理**してください。

- 取得済みの repo / state（plan/currentVersion/monthly/housing/events）はそのまま流用 OK
- ただし **max 3、優先順位、空状態、skeleton/error、primary/secondary CTA、アイコン**などが仕様差分になりやすいので、UI は「差し替え」前提が安全です。

2. **「今月データ入力（Enter This Month’s Data）」の完了判定は `MonthlyRecord が存在するかどうか` を正**とします。

- `isFinalized` は“締め”の概念で、入力済み判定（MVP）には使いません。
- よって D4 も **record exists → 完了** で揃えてください。

3. **改定メモ（Revision Memo）アイテムは “任意（optional）” として追加して OK**です。

- ただし **max 3 の枠に入らなければ表示されない**（押し出される）で問題なし。
- CTA は固定で良い：`改定履歴を見る` → `/plans/[planId]/versions`（詳細が無い前提でも成立）

4. `resolveDashboardState`（オンボーディング/目立つカード）と `nextActions`（チェックリスト）の **二本立ては維持**してください。

- 役割が違うので統合しない方がブレません。

  - `resolveDashboardState`: 初回/重大な欠落の“上位状態”表示
  - `nextActions`: 継続運用の“次にやること”表示（最大 3 件）

---

## 2) Assumption（仮定）

- D7 実装済みのため、D4 は `selectedScenario` を受け取り、必要なら表示に使うだけ（URL 同期は D7）。
- 「改定メモ」は“メモ入力画面”が未確定でも、まずは改定履歴への導線で十分（MVP）。

---

## 3) Design Output（実装指針：迷わない形）

### 既存実装の扱い（Q1）

- **state 取得・ロード構造は維持**
- ただし `nextActions` の生成は、仕様通り **`computeNextActions(...)` の純関数に切り出し**
- UI もその `actions` を描画するコンポーネントに置換（既存カードを差し替え）

### 今月入力の完了判定（Q2）

- ✅ 完了：`currentMonthly !== undefined`
- ❌ 不完了：`currentMonthly === undefined`
- `isFinalized` はチェックリストの完了判定には使わない（使うなら別途「確定」アイテムとして追加する話になります）

### 改定メモ（Q3）

- **追加して OK（optional）**
- 表示条件（MVP で単純にするなら）：

  - `currentVersion` が存在する場合のみ候補にする（無いなら「バージョン作成」が最優先になるため）

- CTA：

  - primary: `改定履歴を見る` → `/plans/[planId]/versions`

### resolveDashboardState と nextActions の関係（Q4）

- **共存**で OK。統合は不要。
- UI 上の見せ方のおすすめ：

  - `resolveDashboardState` が「初回の大きな空状態」なら、そのカードを上に出す
  - その下に `nextActions` は出してもいいし、初回は「やることはありません/まず上の案内を進めてください」でも OK
  - 実装コスト最小は「両方表示（ただし nextActions が 0 なら空状態）」です

---

## 4) Risks（リスク）

- `isFinalized` を完了判定に使うと「保存したのに未完了扱い」になり、運用体験が悪化します（特に入力直後）。
- 既存実装に継ぎ足すと仕様要件（max3/優先度/空状態/CTA 種別）が中途半端に残りやすいので、カードは置換が安全です。

---

## 5) Next（次に作るべきもの：最短ルート）

1. `computeNextActions` を作成（max3・優先度・optional 改定履歴含む）
2. `currentMonthly` の完了判定を **存在ベース**に修正
3. チェックリストカードを新 UI に差し替え（skeleton/error/empty 対応）

必要なら、D4 の「アイテム A〜E（条件・優先度・CTA）」をあなたの現状コード（`resolveDashboardState` / 現 nextActions）に合わせて、テストケースにできる粒度で確定案として書き起こします。
