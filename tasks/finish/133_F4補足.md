## 1) Decision（確定事項）

F4（イベント編集）はご提示の流れ（`events/new` をベースに **get → フォーム反映 → update 保存**）で進めて OK です。そのうえで、確認事項は以下で確定します。

- **Breadcrumb のプラン名**：編集画面でも **`PlanRepo.get(planId)` で取得して表示**します（ローディング中は Skeleton/プレースホルダ）。
- **eventType が定義外**：**フォーム初期表示では `other` に丸める**（警告表示は任意）。保存時も enum 外は保存しない（= `other` として保存）。
- **planId と event.planVersionId 整合**：**入れます（推奨）**。不一致ならイベント一覧へ戻す（＋ toast/alert）。
- **dirty（“変更があります”）**：**入れます（軽量バッジ＋保存ボタン有効/無効）**。housing/assumptions と同じ方式で OK。

---

## 2) Assumption（仮定）

- `LifeEvent` は `id` と `planVersionId`（または `planId`）を持っている。
- `EventRepo.get(eventId)` と `EventRepo.update(event)` が存在。
- 編集ルートは `src/app/plans/[planId]/events/[eventId]/edit/page.tsx` 相当（命名は任意）で、`eventId` を URL から取れる。

---

## 3) Design Output（実装仕様：F4 に落ちる形）

### A. Breadcrumb のプラン名

- 取得：`PlanRepo.get(planId)`
- 表示：

  - 取れたら `プラン一覧 > {planName} > イベント > 編集`
  - 取れない/未ロードは `…` か Skeleton

- 例外：plan が存在しない場合は一覧へ戻す（404 相当でも OK）

### B. eventType が定義外だった場合

- **既存データ互換は不要**とのことですが、実装の堅牢性として最低限のガードだけ入れるのが楽です。
- `eventType` をフォームに流し込む直前に

  - `if (!isKnownEventType(event.eventType)) form.eventType="other"`

- 保存時も同様に `other` へ強制（enum 外を DB に残さない）

> 「そのまま保持」は UI 側の対応（ラベル表示/選択肢）を増やす必要が出るので、MVP ではメリットが薄いです。

### C. planId と event.planVersionId の整合チェック

- 推奨チェック（どちらかで OK）

  1. **イベントが planId を持っているなら**：`event.planId === planId` をチェック（最安）
  2. **planVersionId しかないなら**：

     - `version = VersionRepo.get(event.planVersionId)`
     - `version.planId === planId` をチェック

- 不一致時の挙動（MVP）

  - toast：`このイベントは別プランに属しています`
  - `router.replace(/plans/[planId]/events)` で戻す

### D. dirty（変更あり）表示

- 実装方針（軽量）

  - 初期ロード後に `initialSnapshot` を保持（deep clone）
  - フォーム state と比較して `isDirty` を算出

- 表示

  - 画面ヘッダー右に `変更があります` Badge（housing/assumptions と同形式）
  - `保存` ボタンは `isDirty=false` の場合 disabled

- 任意（やるなら良い）

  - 戻る/遷移時に confirm（ただし MVP ではバッジ＋ disable でも十分）

---

## 4) Risks（リスク）

- plan/version 整合チェックを省くと、URL 直打ち等で「別プランのイベントを編集」できてしまう可能性がある → **チェック入れるのが安全**。
- eventType の未知値を保持すると、UI が破綻する（Select に表示できない等） → **other 丸めが最小コストで安定**。
- dirty 検知を入れないと「保存不要でも保存できる」「保存したか分からない」が起きやすい → バッジ＋ disabled で改善。

---

## 5) Next（次に作るべきもの：最短ルート）

- F4 はまず

  1. `EventRepo.get` でロード → フォーム反映
  2. **整合チェック**（version 照合）
  3. `update` 保存（成功 toast→ 一覧へ戻る）
  4. **dirty バッジ**（最小）
     の順で組むのが最短です。

必要なら、F4 の Jira チケット（AC/DoD 付き）として同じ内容を整形して出します。
