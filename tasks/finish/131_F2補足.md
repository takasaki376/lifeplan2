## 1) Decision（確定事項）

リリース前で既存データ互換を考えなくて良い前提で、F2（イベント作成の入力バリデーション）まわりは **「ドメインを正」ではなく、UI・ドメイン両方を同時に“最終形に揃える”**方針に切り替えます。

- **cadence**：画面・ドメインともに **`"once" | "monthly"` に統一**します。
  → 画面の `"onetime"` は **削除して `"once"` に置換**（互換処理なし）。
- **期間（endMonth / durationMonths）**：保存の正規形は **`durationMonths` のみ**に統一します。
  → 画面の `endMonth` は「入力フィールド」ではなく **自動計算表示（read-only）**に変更（または削除）。
- **金額入力 UI**：MVP の実装容易性と堅牢性を優先して **`type="number"` を維持**します。
  → 「カンマ除去」は仕様としては残しても良いですが、UI が number なら実害がないので **F2 では必須対応にしない**（後で text 化したくなったら別チケット）。
- **startYm（YYYY-MM）形式チェック**：**有効化して OK**です（軽量・効果大）。

---

## 2) Assumption（仮定）

- LifeEvent の保存形は `startYm` / `cadence` / `amountYen` / `durationMonths`（monthly のみ）で表現できる。
- 一回限り（once）は `durationMonths=1` として保存してよい（扱いが単純になる）。

---

## 3) Design Output（F2 対応を“ゼロから”組み直した仕様）

### A. cadence 統一（互換不要）

- UI の選択肢を `once` / `monthly` に変更
- TS 型も `type Cadence = "once" | "monthly"` に統一
- バリデーションは `cadence` がこの 2 つ以外ならエラー

### B. 期間の正（保存）を durationMonths に一本化

**UI/挙動**

- `cadence="once"` のとき：

  - `durationMonths` は非表示 or disabled（内部的に 1 固定）
  - `endMonth` は表示するなら `startYm` と同じを read-only 表示

- `cadence="monthly"` のとき：

  - `durationMonths` を入力（min=1）
  - `endMonth` は **表示のみ**（`startYm` と `durationMonths` から自動計算）

**バリデーション（保存前）**

- `startYm`：必須 + `YYYY-MM` 形式
- `amountYen`：必須 + 数値 + `> 0`
- `cadence="once"`：`durationMonths = 1` をセット（入力値は持たない）
- `cadence="monthly"`：`durationMonths` 必須 + 整数 + `>= 1`

> これで「endMonth と durationMonths の矛盾」という問題がそもそも起きなくなります。

### C. 金額入力は number 維持（仕様を現実に寄せる）

- `type="number"` のままにして、

  - `Number(value)` が `NaN` ならエラー
  - `Math.floor` で整数化（任意）
  - `> 0` を必須

- 将来「カンマ貼り付け」をやりたくなったら、UI を text 化して `parseYen` を入れる（別チケット）

### D. startYm の軽量チェック（有効化）

- 正規表現：`^\d{4}-(0[1-9]|1[0-2])$`
- 形式 NG なら「YYYY-MM 形式で入力してください」

---

### 実装メモ（必要最低限のユーティリティ例）

```ts
export function isValidYm(ym: string): boolean {
  return /^\d{4}-(0[1-9]|1[0-2])$/.test(ym);
}

// endYm計算（表示用）: startYm + (durationMonths-1)
export function addMonthsYm(startYm: string, addMonths: number): string {
  const [y, m] = startYm.split("-").map(Number);
  const total = y * 12 + (m - 1) + addMonths;
  const ny = Math.floor(total / 12);
  const nm = (total % 12) + 1;
  return `${ny}-${String(nm).padStart(2, "0")}`;
}
```

---

## 4) Risks（リスク）

- `endMonth` を入力から外すと UI モックとの差が出る
  → ただし矛盾の温床を消せるので、MVP の安定性は上がります。
- 金額を number のままにすると「1,000,000 を貼り付けたい」ニーズが後で出る
  → その時に text 化 + カンマ許容を別チケットにすれば OK（影響範囲が限定される）。

---

## 5) Next（次に作るべきもの：最短ルート）

1. イベント作成画面の cadence 値を **once/monthly** に統一（表示ラベルは「単発/毎月」で OK）
2. `endMonth` を **read-only 表示**に変更し、保存は durationMonths のみに統一
3. F2 バリデーションを上の仕様で実装（startYm 形式、金額>0、durationMonths>=1）

必要なら、この方針で **F2 の Jira チケット本文（AC/DoD 付き）**も作り直して出します。
