According to a document (date not specified),本アプリの月次コアは「収入・支出・資産残高・負債残高」を継続入力する前提です。

## 1) Decision（確定事項）

1. **「入力済み」判定は MonthlyRecord の“存在”だけで OK（MVP）**にします。

   - `isFinalized` は将来の拡張（確定/締め）として残し、**E1 のフィルタ「入力済み/未入力」は record 有無**で判定します。

2. **数値未入力の表示は `—` に統一**します（`formatYen()` の `?` 表示は一覧では使わない）。
3. **年選択候補は「動的生成」を推奨**します（`MonthlyRepository.listByPlan(planId)` から年集合を作る）。

   - ただしデータ 0 件の初期状態のために **fallback で「今年 ±2 年」を併用**します。

4. **初期表示年は「データがあれば最新年、なければ今年」**にします。

## 2) Assumption（仮定）

- `MonthlyRepo.listByPlan(planId)` が取得可能（または `listByPlanAndYear` があればそれでも OK）。
- `MonthlyRecord` に `ym: "YYYY-MM"` がある（なければ `date`/`year`/`month` 相当から年を計算）。
- `isFinalized` が存在しても、MVP は「入力済み＝存在」で統一し、**必要ならバッジ表示だけ追加**（確定）に留めます。

## 3) Design Output（E1 実装に落とす具体仕様）

### 3-1. 入力状態（E1 フィルタ用）

- `monthly = MonthlyRepo.getByYm(planId, ym)`
- `monthly === undefined` → `未入力`
- `monthly !== undefined` → `入力済み`
- もし `isFinalized` があるなら（任意）

  - `入力済み` の中で `確定` バッジを追加表示（フィルタ軸にはしない）

### 3-2. 数値の表示

- 一覧セルの表示は `—` を基本にする

  - 例：`assetsBalanceYen == null` → `—`

- `formatYen()` は「数値だけ受ける」ままでも OK で、一覧側で

  - `value == null ? "—" : formatYen(value)`
    のラッパーにするのが安全です（`?` 表示が混ざらない）

### 3-3. 年候補（動的＋ fallback）

- `records = MonthlyRepo.listByPlan(planId)`（または年跨ぎ取得）
- `years = unique(records.map(r => yearOf(r.ym)))`
- `years.size === 0` のときだけ `[(thisYear-2)..(thisYear+2)]` を提示
- `years.size > 0` のときは、`years` を昇順（or 降順）表示

  - UX 的には降順（最新が上）が使いやすいです

### 3-4. 初期表示年

- `years.size > 0` → `initialYear = max(years)`
- `years.size === 0` → `initialYear = thisYear`

## 4) Risks（リスク）

- `isFinalized` を入力済み判定にすると「保存したのに未入力扱い」になり、MVP の体験が悪化しやすい（特に E3 直後）。
- 年候補を固定だけにすると、過去/未来年のデータがあるユーザーで「選べない」状態が起きる。動的生成＋ fallback が一番事故が少ないです。

## 5) Next（次に作るべきもの：最短ルート）

- E1 は上記の方針で実装開始して OK です。
- 実装が進んだら、必要に応じて「確定（isFinalized）フィルタ」を **E1-拡張チケット**として追加するのが最短です。
