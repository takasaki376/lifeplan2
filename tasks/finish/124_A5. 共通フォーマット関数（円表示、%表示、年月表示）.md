# Jira チケット（A5）共通フォーマット関数（円表示、%表示、年月表示）

## Summary

A5. 共通フォーマット関数（円表示、%表示、年月表示）実装

## Issue Type

Task（または Story）

## Priority

Medium（ただし UI 実装が進むほど重要度が上がる）

## Background / Context

MVP の各画面（プラン一覧、ダッシュボード、月次、住宅 LCC、イベント等）で、金額・割合・年月の表示が頻出する。  
画面ごとにフォーマットロジックが散らばると不整合や修正コストが増えるため、共通ユーティリティとして集約する。

## Goal

- 円（JPY）表示、割合（%）表示、年月（YYYY-MM）表示を共通関数で提供する
- 未入力（undefined/null）や 0 の扱いを統一する
- UI はこの共通関数を使うことで一貫した表示になる

---

## In Scope

- `src/lib/format/`（例）にフォーマット関数を実装
- 主要フォーマット：
  - `formatYen`（円）
  - `formatPercent`（%）
  - `formatYearMonth`（YYYY-MM → 日本語表記）
  - `getCurrentYearMonth`（現在年月キー生成）
  - （任意）`parseYenInput`（入力文字 →number）
- 例外/未入力値の表示方針を定義（"—" など）

## Out of Scope

- 入力コンポーネント（カーソル制御など）自体の実装
- Zod 等の厳密バリデーション（J1）
- 国際化(i18n)対応（MVP では日本語固定）

---

## Deliverables

- `src/lib/format/index.ts`（または分割ファイル）に関数実装
- 使用例をコメントまたは `docs/formatting.md` に記載（任意）

---

## Functional Requirements（仕様）

### 1) 円表示 `formatYen(value, options?)`

- 入力：`number | null | undefined`
- 出力例：
  - `1234567` → `1,234,567円`
  - `0` → `0円`（オプションで "—" にもできる）
  - `undefined/null` → `—`（デフォルト）
- オプション例：
  - `compact?: boolean`（例：`1234000` → `123.4万円` ※MVP では不要なら省略可）
  - `showDashForEmpty?: boolean`（default true）
  - `suffix?: string`（default "円"）
  - `sign?: "auto" | "always" | "never"`（収支の+表示用）

### 2) %表示 `formatPercent(value, options?)`

- value は内部表現を **小数（0.012）** とする前提
- 出力例：
  - `0.012` → `1.2%`
  - `0.03` → `3%`（小数桁は options で調整）
  - `undefined/null` → `—`
- オプション例：
  - `digits?: number`（default 1）
  - `showDashForEmpty?: boolean`（default true）

### 3) 年月表示 `formatYearMonth(ym)`

- 入力：`"YYYY-MM"` 形式（例：`"2026-01"`）
- 出力例：
  - `"2026-01"` → `2026年1月`
- 変換失敗時：
  - `—` または元文字列を返す（方針を統一）
- 併せて以下も用意（任意）
  - `toYearMonth(date: Date): YearMonth`（現在年月キー生成）
  - `prevYearMonth(ym)` / `nextYearMonth(ym)`（月次ナビ用）

### 4) 入力パース（任意）`parseYenInput(text)`

- UI 入力で `"1,234,567"` のようなカンマ入りを受け、`1234567` にする
- 空文字は `undefined` を返す（or 0）※方針を統一
- 全角数字対応（任意）

---

## Technical Notes

- `Intl.NumberFormat('ja-JP')` を利用（パフォーマンスのため formatter は再利用推奨）
- Next.js（クライアント/サーバー）どちらでも動く純関数にする
- `YearMonth` 型（B1）を参照できるなら参照（依存循環に注意）

---

## Acceptance Criteria

- [ ] `formatYen` が `undefined/null` を `—` に、number を `#,###円` に整形できる
- [ ] `formatPercent` が小数 →%表示に変換できる（桁指定可能）
- [ ] `formatYearMonth` が `"YYYY-MM"` → `YYYY年M月` に変換できる
- [ ] `toYearMonth(new Date())`（または `getCurrentYearMonth`）で現在年月キーが作れる
- [ ] 主要画面で利用できる形で export されている
- [ ] lint/typecheck が通る

## Definition of Done

- [ ] PR 作成＆レビュー完了
- [ ] 簡易テスト（手動でも OK）：いくつかの値で出力が期待通りであることを確認
- [ ] 使用例がコメントまたは docs にある（任意だが推奨）

---

## Dependencies

- なし（B1 の YearMonth 型を使う場合は依存に注意）

## Follow-ups（関連チケット）

- E3/E5：月次入力での表示整形に利用
- G1/G9：住宅 LCC 表示での金額整形に利用
- F1/F2：イベント金額・年月表示に利用
