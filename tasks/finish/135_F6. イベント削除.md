# Jira チケット（F6）イベント削除（confirm）

## Summary

F6. イベント削除（confirm）— 確認ダイアログ付きで安全に削除できる

## Issue Type

Story（または Task）

## Priority

High（誤登録の修正手段として必須）

## Background / Context

イベントは将来見通しや家計の反映に影響するため、誤登録・不要になったイベントを安全に削除できる必要がある。  
誤操作を防ぐため、削除は必ず confirm（確認）を挟む。

MVP 永続化は IndexedDB のため、B5 の EventRepository を利用する。

## Goal

- イベント一覧（および任意で編集画面）から削除を実行できる
- 削除前に確認ダイアログを表示し、誤削除を防げる
- 削除後は一覧へ反映（消える）し、toast で通知される
- 失敗時にユーザーへ分かる通知が出る

---

## In Scope

- 削除アクションの UI 接続
  - イベント一覧（F1）の行メニューに「削除」
  - （任意）イベント編集（F4）のヘッダー/メニューにも「削除」
- confirm ダイアログ（必須）
- Repo 連携：
  - `EventRepo.delete(eventId)`
- UI 更新：
  - 一覧の再取得 or state から除外
- toast（成功/失敗）
- 二重送信防止（削除中 disabled）

## Out of Scope

- ゴミ箱（論理削除）機能
- バージョン差分への影響表示（H 系）
- 削除の取り消し（Undo）※将来

---

## Functional Requirements

### 1) UI 導線

- イベント一覧の各行メニュー（DropdownMenu）に `削除`（destructive）
- モバイルでも押しやすい配置（誤タップを防ぐためメニュー内推奨）

### 2) confirm ダイアログ

- Title：`イベントを削除しますか？`
- Description：
  - `この操作は取り消せません。将来の見通しからも反映が消えます。`
- 表示する詳細（任意だが推奨）：
  - タイトル
  - 発生月（startYm）
  - 金額（amountYen、支出/収入）
- Buttons：
  - `キャンセル`（default）
  - `削除`（destructive）

### 3) 削除処理

- `削除` を押すと：
  - loading state ON（ボタン disabled）
  - `await EventRepo.delete(eventId)`
- 成功時：
  - toast：`削除しました`
  - 一覧を更新（再 fetch or state 除外）
  - ダイアログを閉じる
- 失敗時：
  - toast：`削除に失敗しました`
  - ダイアログは開いたままでも閉じても OK（方針を決める）
  - loading state OFF

### 4) エラーケース

- eventId が存在しない/既に削除済み
  - toast：`イベントが見つかりません`
  - 一覧を再読み込みして整合

---

## UI Requirements

- shadcn/ui:
  - `AlertDialog`（confirm 用）
  - `DropdownMenu`（行メニュー）
  - `Button`（destructive variant）
  - `toast`（sonner 等）
- 削除アクションは赤系（destructive）で統一
- 削除中は二重実行不可

---

## Technical Notes

- `"use client"`（IndexedDB）
- Repo：
  - `EventRepo.delete(eventId)`
- 一覧更新方式（どちらか採用）
  - 方針 A：削除後に `EventRepo.listByVersion(...)` を再実行して再描画（簡単・安全）
  - 方針 B：state から対象 eventId を除外（高速、ただしズレに注意）
- 金額/年月表示は A5 util（formatYen/formatYearMonth）を利用推奨

---

## Acceptance Criteria

- [ ] イベント一覧の行メニューから「削除」を選べる
- [ ] confirm ダイアログが必ず表示される
- [ ] 確認で「削除」を押すと IndexedDB から削除される
- [ ] 削除後に一覧から当該イベントが消える（更新される）
- [ ] 成功/失敗時に toast が表示される
- [ ] 削除中は二重送信できない（disabled）
- [ ] lint/typecheck が通る

## Definition of Done

- [ ] PR 作成＆レビュー完了
- [ ] 手動テスト手順が PR に記載
  - 削除 →confirm→ 成功 → 一覧反映
  - キャンセルで何も起きない
  - 失敗（Repo を throw）→toast→ 再試行可能
- [ ] lint/typecheck が通る

---

## Dependencies

- B5（EventRepo 実装）
- F1（一覧に削除導線を付ける場合）
- （任意）F4（編集画面にも削除導線を付ける場合）
- （推奨）A5（年月/金額フォーマット）

## Follow-ups（関連チケット）

- （将来）Undo（取り消し）/ ゴミ箱（論理削除）
- （将来）削除の監査ログ（改定履歴に反映）

---

## Decisions

- Missing delete target: EventRepo.delete throws RepoNotFoundError.
- Edit page delete: not implemented in this ticket.
- After delete: remove item from local state (no refetch).
