# Jira チケット（B6）将来 Supabase 用 Repository のスタブ作成（interface 準拠、未接続で OK）

## Summary

B6. 将来 Supabase 用 Repository のスタブ作成（interface 準拠、未接続で OK）

## Issue Type

Story（または Task）

## Priority

Medium（※MVP リリースに必須ではないが、早めに入れると移行が楽）

## Background / Context

MVP は IndexedDB を採用するが、将来的に Supabase（Postgres）へ移行する計画がある。  
B4 で定義した Repository インターフェースを、**Supabase 実装に差し替え可能**な状態にするため、まずは **スタブ（未接続・未実装で OK）** を作成して、依存構造と差し替えポイントを明確化する。

## Goal

- Supabase 版 Repository の“骨格”を作り、IndexedDB 版と差し替え可能であることを確認する
- まだ接続しない（環境変数が無くてもビルドが通る）
- 将来の実装時に必要な「テーブル対応表」「メソッド対応表」をドキュメント化する

---

## In Scope

- Supabase Repository クラス/関数の雛形作成（interface 準拠）
- `createClient` の配置方針（ただし未接続、呼ばれない/呼べない前提でも OK）
- 各メソッドは `throw new Error("Not implemented")` で可（ただし型は満たす）
- 実装 TODO コメント、テーブル/クエリ対応表（最低限）
- DI（依存注入）または Factory で IndexedDB/Supabase の切替ポイントを作る（最小で OK）

## Out of Scope

- 実際の Supabase 接続（キー設定/ログイン/Row Level Security 等）
- SQL/テーブル作成/マイグレーション
- CRUD の実装（将来チケットに分離）

---

## Deliverables

- `src/lib/repo/supabase/` 配下にスタブ実装を追加（例）
  - `planRepo.ts`
  - `versionRepo.ts`
  - `monthlyRepo.ts`
  - `eventRepo.ts`
  - `housingRepo.ts`
  - `index.ts`
- `src/lib/supabase/client.ts`（任意：スタブ。環境変数が無い場合は初期化しない/遅延初期化）
- `docs/supabase-mapping.md`（任意だが推奨）
  - interface メソッド ↔ テーブル/クエリの対応表
  - RLS や認証導入時の論点メモ

---

## Implementation Requirements（重要）

- ビルドが通ること（環境変数が無くても `import` で落ちない）
- 実行されても明確に失敗すること（例：`throw new Error("SupabaseRepository not connected yet")`）
- interface は必ず満たす（B4 の型を全て実装）
- IndexedDB 版と同じ export 形式で差し替えできること（Repo Factory / DI）

---

## Suggested Structure（例）

### 1) Supabase Client（スタブ）

- `createSupabaseClient()` は呼ばれたら環境変数をチェックし、なければ throw
- ただし、アプリ起動時に自動で呼ばない（遅延初期化）

### 2) Repo Factory（切替点）

- `getRepositories()` のような Factory を用意
  - MVP では常に IndexedDB を返す
  - 将来フラグ（env）で Supabase に切替可能

---

## Acceptance Criteria

- [ ] `src/lib/repo/supabase/*` が追加されている
- [ ] B4 の interface を全て実装し、TypeScript 的にコンパイルが通る
- [ ] 環境変数が無い状態でも `yarn dev` / `yarn build` が動く（import 時に落ちない）
- [ ] Supabase Repo を呼ぶと明確な未実装エラーになる（静かに失敗しない）
- [ ] docs に「テーブル対応表」または「実装 TODO」が残っている

## Definition of Done

- [ ] PR 作成＆レビュー完了
- [ ] Factory/DI の切替ポイントが最低限用意されている
- [ ] README or docs に Supabase 移行の前提が記載されている（数行で OK）

---

## Dependencies

- B4（Repository インターフェース定義）
- （推奨）B1（ドメイン型）

## Follow-ups（関連チケット）

- Supabase 実装（本実装）：Plan/Monthly/Event/Housing/Version CRUD
- Supabase テーブル定義＆RLS 設計
- Auth 導入（Supabase Auth）
