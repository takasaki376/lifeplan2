## 回答（D7 としての方針を確定）

### 1) Context/Provider にする？ props で渡す？

**結論：D7 では props で十分（推奨）**です。

- 仕様でも「props で渡す」としており、MVP ではカード数も限定的で、依存関係が見通しやすいです。
- Context 化は便利ですが、導入すると「どこで値が変わるか」が追いにくくなりがちで、MVP の段階では過剰になりやすいです。

**ただし例外**：ダッシュボード直下にネストが深い/カード構成が頻繁に変わる/多階層で渡し回しが辛くなったら、後続チケットで `ScenarioProvider` を切れば OK です（今は不要）。

---

### 2) “standard” を “base” に変える？ 置換は必要？

**結論：はい、全部 “base” に統一してください。**

- URL クエリ仕様が `scenario=conservative|base|optimistic` なので、コード上のキーも同一に揃えた方が事故が減ります。
- `standard` を残すと、URL と内部状態がズレてバグが出やすい（特にリンク引き継ぎやフォールバック）。

やること：

- TabsTrigger の値：`standard` → `base`
- 型・定数・分岐：`standard` 参照をすべて `base` に置換
- **デフォルト＆フォールバックは必ず `base`**

（表示ラベルは「標準」で OK。キーだけ `base`。）

---

### 3) ヘルパー（src/lib/scenario.ts）の置き場所は？ ドメイン型の近く？

**結論：`src/lib/scenario.ts` のように “共通 lib” に置くのが最適**です。

- ドメイン型（`src/lib/domain/types.ts` 等）に密結合させるより、**UI/ルーティング（searchParams）とドメインの接点**として “lib” に置くと再利用しやすいです。
- D4（next actions）や G1/D5 の scenario 適用でも同じ `parseScenario` を使えます。

推奨構成：

- `src/lib/scenario.ts`

  - `export type ScenarioKey = "conservative" | "base" | "optimistic"`
  - `export const scenarioKeys = [...] as const`
  - `export function parseScenario(v: string | null | undefined): ScenarioKey`
  - `export function formatScenarioLabel(key: ScenarioKey): "保守"|"標準"|"楽観"`（任意）

---

## D7 実装の最終指示（迷わず着手できる形）

- source of truth：`useSearchParams().get("scenario")`
- `parseScenario` で `base` フォールバック
- 切替時は `router.replace(updatedUrl)`（履歴を増やさない）
- local-state fallback：**不要寄り**（URL が真実なら state 二重管理はバグ源）
  ただし仕様に合わせるなら「URL が無い/読めない環境のときだけ `useState("base")`」程度で OK。基本は URL のみで成立させてください。
- `selectedScenario` を Dashboard page で決めて、D5/D6/D3 に **props で渡す**

必要なら、D7 の実装用に `router.replace` で「既存クエリを保持したまま scenario だけ差し替える」コード例も作ります。
