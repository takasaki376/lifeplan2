# Jira チケット（C1）プラン一覧：IndexedDB 連携（list/search/filter/archive）

## Summary

C1. プラン一覧：IndexedDB 連携（list / search / filter / archive）

## Issue Type

Story（または Task）

## Priority

High

## Background / Context

v0 でプラン一覧画面の UI モックは作成済み。  
MVP では永続化を IndexedDB で行うため、B5 で実装した `PlanRepository` を用いて、一覧表示・検索・フィルタ・アーカイブ操作を実装する。

本画面はユーザーの入口であり、プラン作成（/plans/new）・プラン詳細（/plans/[planId]）への導線の起点になる。

## Goal

- IndexedDB（Repository）からプランを取得して一覧表示できる
- 検索・フィルタ（すべて/入力が必要/最近更新/アーカイブ）で絞り込める
- アーカイブ/復元ができる（削除は別タスクでも OK）
- 空状態（プランなし）を正しく表示し、作成導線へ誘導できる

---

## In Scope

- 画面 `/(プラン一覧)` または `/plans` の実装（プロジェクトのルーティングに合わせる）
- `PlanRepository.list()` を用いた一覧取得
- UI の検索入力によるフィルタ（クライアント側）
- タブ/セグメントによるフィルタ
  - すべて
  - 入力が必要（今月未入力のプラン）
  - 最近更新（updatedAt 降順表示）
  - アーカイブ（archived のみ）
- カードのアクション
  - 「開く」→ /plans/[planId]
  - 「月次入力」→ /plans/[planId]/months/current
  - メニュー：
    - 「住宅 LCC を見る」→ /plans/[planId]/housing
    - 「改定履歴」→ /plans/[planId]/versions
    - 「複製」→ PlanRepo/VersionRepo の複製（C4 と連携。未実装なら disabled 可）
    - 「アーカイブ」/「復元」
    - 「削除」（MVP で後回しなら disabled 可）
- 空状態（プラン 0 件）表示と「新規プラン作成」導線

## Out of Scope

- プラン作成ウィザードの保存処理（C2）
- プラン複製の実装（C4）
- プラン削除の実装（C6）
- サーバーサイドレンダリング最適化（IndexedDB なので基本クライアントのみ）

---

## Functional Requirements（振る舞い）

### 一覧取得

- 初期表示：`status=active` のプランを `updatedAt desc` で表示
- アーカイブタブ：`status=archived` のみ表示

### 検索

- プラン名に対する部分一致（大文字小文字は問わない想定）
- 検索はクライアント側で OK（Repo 側検索は MVP 不要）

### フィルタ：「入力が必要」

- 判定ルール（MVP の簡易ルール）
  - 当月 `ym` に対応する `MonthlyRecord` が存在しない → 「今月未入力」
- 実装方針
  - `MonthlyRepository.getByYm(planId, currentYm)` を並列呼び出し
  - 結果を `needsInput` フラグとして UI に付与
  - 件数が増えたら最適化（MVP は OK）

### フィルタ：「最近更新」

- `updatedAt desc` を維持（デフォルトと同じでも OK）
- 可能なら「最終更新日」バッジ/表示を強調

### アーカイブ/復元

- メニュー操作で confirm（任意だが推奨）
- 実行後は toast 表示
  - “アーカイブしました”
  - “復元しました”
- 一覧を自動更新（再 fetch or state 更新）

---

## UI Requirements

- v0 で生成済みの UI を維持（shadcn/ui）
- ローディング（Skeleton）または “読み込み中…” を表示
- エラー時は toast or Alert で通知
- モバイルではカード Actions はメニューに集約（崩れないこと）

---

## Technical Notes

- IndexedDB はクライアントのみ：`"use client"` コンポーネントで実装
- `currentYm` は `"YYYY-MM"`（例：`2026-01`）で生成（共通 util を使用）
- Repo 取得は `useEffect` + state、または `use`/Server Components は使わない（IndexedDB のため）
- 依存 Repo：
  - PlanRepository
  - MonthlyRepository（needsInput 判定用）

---

## Acceptance Criteria

- [ ] IndexedDB（Repository）からプラン一覧が表示される
- [ ] 検索でプラン名が絞り込める
- [ ] タブ（すべて/入力が必要/最近更新/アーカイブ）で表示が切り替わる
- [ ] 「入力が必要」は当月 MonthlyRecord 有無で判定される
- [ ] 「開く」「月次入力」「住宅 LCC」「改定履歴」導線が動く
- [ ] アーカイブ/復元が動き、toast 表示＋一覧更新される
- [ ] プラン 0 件の空状態が表示され、「新規プラン作成」へ遷移できる

## Definition of Done

- [ ] PR 作成＆レビュー完了
- [ ] 手動テスト手順が PR に記載（最小：作成 → 一覧 → 検索 → アーカイブ → 復元）
- [ ] lint/typecheck が通る

---

## Dependencies

- B5（IndexedDB Repo 実装）
- （任意）E 系（月次 Repo）が存在すると「入力が必要」判定が実装しやすい

## Follow-ups（関連チケット）

- C2. プラン作成ウィザード：保存処理
- C4. プラン複製
- C6. プラン削除
