# Jira チケット（F1）イベント一覧：IndexedDB 連携（今後/過去/すべて、種別、単発/毎月）

## Summary

F1. イベント一覧：IndexedDB 連携（今後/過去/すべて、種別、単発/毎月）

## Issue Type

Story（または Task）

## Priority

High

## Background / Context

v0 でイベント一覧画面の UI モックは作成済み。MVP の永続化は IndexedDB のため、B5 で実装した EventRepository を用いて、
イベント一覧を表示し、フィルタ（今後/過去/すべて、種別、単発/毎月）で絞り込めるようにする。

イベントは planVersionId 配下（改定で前提が変わる）で管理し、ダッシュボードや将来見通しの基礎データとなる。

## Goal

- `/plans/[planId]/events` で現行 Version のイベントを一覧表示できる
- フィルタ（今後/過去/すべて、種別、単発/毎月）で即時に絞り込みできる
- 「イベントを追加」導線（/events/new）と編集導線（/events/[eventId]/edit）が動く
- 空状態（0 件/フィルタ該当なし）が適切に表示される

---

## In Scope

- 画面：`/plans/[planId]/events`
- Repo 連携：
  - `VersionRepo.getCurrent(planId)` で currentVersion を取得
  - `EventRepo.listByVersion(planVersionId, ...)` で一覧取得（または全件取得）
- フィルタ UI の状態管理（v0 モックに準拠）
  - タブ：今後 / 過去 / すべて
  - Select：種別（出産/教育/転職/退職/介護/住居/その他/すべて）
  - Select：形態（単発/毎月/すべて）
  - （任意）検索：イベント名部分一致
- グルーピング表示（推奨：年 → 月）
- 主要導線：
  - `イベントを追加` → `/plans/[planId]/events/new`
  - 行クリック or 編集ボタン → `/plans/[planId]/events/[eventId]/edit`

## Out of Scope

- イベント作成/編集の保存ロジック（F2〜F4）
- 複製/削除（F5/F6）
- 将来見通しへの反映（I2）
- 高度なインフレ連動など（将来）

---

## Functional Requirements

### 1) 現行 Version 取得

- 画面初期化時：
  - `currentVersion = VersionRepo.getCurrent(planId)`
- currentVersion が無い場合：
  - 表示：`現行バージョンがありません`
  - CTA：`改定を作成` → `/plans/[planId]/versions/new`（将来でも OK）

### 2) 一覧取得

- `events = EventRepo.listByVersion(currentVersion.id, { scope: "all" })`（推奨）
- ソート基準：
  - 基本：`startYm asc`（今後は近い順、過去は遠い順でも可）
  - UI 上はグループで整える

### 3) “今後/過去/すべて” フィルタ

- `currentYm`（"YYYY-MM"）と比較して判定
  - 今後：`event.startYm >= currentYm`
  - 過去：`event.startYm < currentYm`
  - すべて：全件
- 月比較は文字列比較で OK（"YYYY-MM" のため）

### 4) 種別フィルタ

- `eventType`（string）で一致フィルタ
- UI 選択肢：
  - すべて / 出産 / 教育 / 転職 / 退職 / 介護 / 住居 / その他
- データは柔軟に（eventType は string）だが、UI は既定選択肢を提示

### 5) 形態（単発/毎月）フィルタ

- `cadence` で一致フィルタ
  - 単発：`once`
  - 毎月：`monthly`

### 6) 表示（MVP 最小）

- 各イベント行に表示：
  - 発生月（`YYYY/MM` or `YYYY年M月`）
  - タイトル（無ければ eventType を表示）
  - バッジ：種別、形態（単発/毎月）、収支区分（支出/収入）
  - 金額：`amountYen`（収入は緑、支出は赤のニュアンス）
  - （毎月の場合）`/月` 表示、期間（durationMonths）があれば `◯ヶ月`
- グルーピング（推奨）：
  - 年ごと → 月ごとにまとめる（視認性重視）

### 7) 空状態

- 全件 0 件：
  - Empty：`イベントがまだありません`
  - CTA：`イベントを追加` → `/events/new`
  - （任意）`例を追加（サンプル）`（local state に追加。MVP で便利）
- フィルタ該当なし：
  - `条件に合うイベントがありません`
  - CTA：`フィルタをリセット`

### 8) ローディング/エラー

- ローディング：Skeleton or `読み込み中...`
- エラー：toast or Alert `イベントの取得に失敗しました`

---

## UI Requirements

- v0 モック準拠（shadcn/ui）
- モバイルで操作が崩れない
- フィルタ操作は即時反映（ローカル state）

---

## Technical Notes

- `"use client"`（IndexedDB）
- util（A5）：
  - `getCurrentYearMonth()`（currentYm）
  - `formatYearMonth(ym)`（表示）
  - `formatYen(amount)`（表示）
- Repo：
  - `VersionRepo.getCurrent(planId)`
  - `EventRepo.listByVersion(planVersionId, filters?)`
- MVP 実装方針：
  - Repo が filter 対応していなくても、まずは全件取得 →UI 側で filter で OK（件数が少ない前提）

---

## Acceptance Criteria

- [ ] `/plans/[planId]/events` で現行 Version のイベントが表示される
- [ ] タブ（今後/過去/すべて）で絞り込みできる
- [ ] 種別フィルタで絞り込みできる
- [ ] 形態（単発/毎月）フィルタで絞り込みできる
- [ ] “イベントを追加” で作成画面へ遷移できる
- [ ] イベント行から編集画面へ遷移できる
- [ ] 空状態（0 件/該当なし）が適切に表示される
- [ ] ローディング/エラー表示がある
- [ ] lint/typecheck が通る

## Definition of Done

- [ ] PR 作成＆レビュー完了
- [ ] 手動テスト手順が PR に記載（フィルタ切替・遷移・空状態）
- [ ] lint/typecheck が通る

---

## Dependencies

- B5（VersionRepo / EventRepo 実装）
- A5（年月・金額フォーマット util）※推奨

## Follow-ups（関連チケット）

- F2. イベント作成：入力バリデーション
- F3. イベント作成：保存
- F4. イベント編集：更新
- F5/F6. 複製/削除
