# Jira チケット（D5-1）D5→G1 遷移：scenario クエリ引き継ぎ（/housing?scenario=...）

## Summary

D5-1. D5（住宅 LCC サマリー）→ G1（住宅 LCC 比較）遷移で scenario を URL クエリで引き継ぐ

## Issue Type

Task（サブタスク）

## Priority

Medium（体験の一貫性・比較の再現性のため）

## Background / Context

D7 でシナリオ切替（URL クエリ `scenario`）を導入し、D5 も selectedScenario で表示が切り替わる。
この状態で D5 から G1（住宅 LCC 比較トップ）へ遷移する際に、scenario を引き継がないと、
遷移先が base 表示になり、ユーザーが「切替が反映されていない」と感じる原因になる。

本タスクでは、D5 内のリンク生成を修正して、常に `/housing?scenario=...` を付与する。

## Goal

- D5 内の「住宅 LCC 比較へ」リンクが、常に `scenario` をクエリに含めて遷移する
- `selectedScenario` が不正/未定義の場合は `base` を付与する
- 既存の導線（前提編集等）を壊さない

---

## In Scope

- D5 カード内の CTA `住宅LCC比較へ` のリンク生成修正
  - `/plans/[planId]/housing?scenario=<selectedScenario>`
- `selectedScenario` のフォールバック処理
  - undefined/不正 → `base`
- E2E 的な手動確認のテスト手順追加（DoD）

## Out of Scope

- ダッシュボード内の他リンク（イベント/月次等）への scenario 付与
- G1 側の scenario パース実装（G1-1 で対応済み想定）
- シナリオの永続保存（ユーザー設定）

---

## Spec

### 1) URL 生成

- 目的 URL：
  - `/plans/${planId}/housing?scenario=${scenario}`
- scenario の正規化：
  - `scenario = parseScenario(selectedScenario) // conservative|base|optimistic`
  - 取れない場合は `base`

### 2) 実装方式

- Link の場合（推奨）：
  - `href={{ pathname: /plans/[planId]/housing, query: { scenario } }}`
  - または文字列で `.../housing?scenario=${scenario}`
- router.push の場合：
  - 同様に query を含める

### 3) 表示上の変更

- UI ラベルはそのまま（「住宅 LCC 比較へ」）
- クリック時の挙動のみ変更

---

## Acceptance Criteria

- [ ] D5 の「住宅 LCC 比較へ」をクリックすると、URL に `?scenario=` が付与されて遷移する
- [ ] scenario=conservative/base/optimistic いずれでも正しい値が付与される
- [ ] selectedScenario が未定義/不正でも `scenario=base` で遷移する
- [ ] lint/typecheck が通る

## Definition of Done

- [ ] PR 作成＆レビュー完了
- [ ] 手動テスト手順を PR に記載
  - ダッシュボードで scenario を切替 → D5 CTA クリック → 遷移先 URL に scenario が付いている
  - 不正 scenario 状態（URL 直打ち等）でも base で遷移
- [ ] lint/typecheck が通る

---

## Dependencies

- D5（シナリオ連動版）
- D7（selectedScenario の決定）
- （推奨）`parseScenario` util（D7 で作成済み）

## Follow-ups

- ダッシュボード内の他導線（例：住宅前提編集）にも scenario 表示/引き継ぎを適用するか検討
