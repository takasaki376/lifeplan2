# Jira チケット（E1）月次一覧：年選択・状態フィルタ（未入力/入力済み）＋ IndexedDB 連携

## Summary

E1. 月次一覧：年選択・状態フィルタ（未入力/入力済み）＋ IndexedDB 連携

## Issue Type

Story（または Task）

## Priority

High

## Background / Context

v0 で「月次一覧」画面の UI モックは作成済み。  
MVP では永続化が IndexedDB のため、B5 で実装した `MonthlyRepository` を用いて、年別の月次データを一覧表示し、  
状態フィルタ（未入力/入力済み）で絞り込めるようにする。

本画面は「継続入力」の中心であり、月次入力（かんたん/詳細）への導線を担う。

## Goal

- 指定した年の月次レコード一覧を表示できる（IndexedDB 連携）
- 状態フィルタ（すべて/未入力/入力済み）で表示が切り替わる
- 当月を強調表示し、月次入力画面へ遷移できる
- レコードがない年でも「未入力」として月を並べ、入力導線を提供できる

---

## In Scope

- 画面：`/plans/[planId]/months`
- 年選択 UI（Select）：
  - 表示年を切り替える（例：2024/2025/2026）
- 状態フィルタ UI（Tabs またはセグメント）：
  - すべて
  - 未入力
  - 入力済み
- IndexedDB（Repository）連携：
  - `MonthlyRepository.listByPlan(planId, { year })` で当該年のレコードを取得
- 年の 12 ヶ月分を表示（レコードが無い月も行として表示）
- 各月行の最低限表示：
  - 月ラベル（YYYY 年 M 月）
  - ステータスバッジ（未入力/入力済み）
  - 収入/支出/収支（存在する場合のみ）
  - 最終更新日（存在する場合のみ）
  - アクション（入力/編集、詳細）
- 空状態（プランに月次が一件もない場合）

## Out of Scope

- 行アクションの拡充（複製/削除などは E2/E10）
- 前月コピー（E4）
- 収支自動計算（E5）
- 詳細内訳の保存（E6 以降）

---

## Functional Requirements

### 1) 年の扱い

- 初期表示年：
  - 原則「今年」をデフォルト（例：2026 年）
  - ただし対象プランの月次が存在する場合は、最新レコード年を優先しても良い（任意）
- 年候補：
  - MVP は固定候補（今年 ±2 年）でも OK
  - 可能なら「月次データが存在する年」を動的に候補化（後回しでも OK）

### 2) 月リスト生成（12 ヶ月）

- 表示対象年の 1 月〜12 月 を必ず行として生成
- Repo から取得したレコードを `ym` でマップし、該当月に差し込む
- レコードがない月：
  - ステータス：未入力
  - 数値：非表示（または “—”）
  - アクション：入力する

### 3) 状態フィルタ

- すべて：12 ヶ月すべて表示
- 未入力：レコードがない月のみ表示
- 入力済み：レコードがある月のみ表示
- 右上などに集計表示（任意）：
  - 入力済み: X / 12

### 4) 当月ハイライト

- `currentYm`（今年の YYYY-MM）が表示年に含まれる場合、該当行を強調（背景/左ボーダー）
- 当月の状態（未入力/入力済み）が分かりやすいこと

### 5) 遷移（最低限）

- 月行クリック or ボタンで「かんたん入力」へ
  - `/plans/[planId]/months/[yyyy-mm]`（または current へ）
- 「詳細」ボタン
  - `/plans/[planId]/months/[yyyy-mm]/detail`
- ヘッダーに「今月を入力」ボタン（任意だが推奨）
  - `/plans/[planId]/months/current`

### 6) ローディング / エラー

- 初回読み込み中：Skeleton or “読み込み中…”
- 失敗時：toast（“読み込みに失敗しました”）＋リトライ導線（任意）

---

## Technical Notes

- `"use client"` コンポーネント（IndexedDB）
- `ym` は `"YYYY-MM"` を厳守（B1/B2 準拠）
- util（A5）を利用：
  - `formatYearMonth(ym)`（YYYY 年 M 月表示）
  - `getCurrentYearMonth()`（当月取得）
  - `formatYen()`（金額表示）
- Repo 利用：
  - `MonthlyRepository.listByPlan(planId, { year, sort: "ymAsc"|"ymDesc" })`
  - 取得後、Map 化して 12 ヶ月配列にマージ

---

## Acceptance Criteria

- [ ] `/plans/[planId]/months` で指定年の月次一覧が表示される（Repo 連携）
- [ ] 年選択で表示年が切り替わる
- [ ] フィルタ（すべて/未入力/入力済み）で表示が切り替わる
- [ ] レコードがない月も「未入力」として表示され、入力導線がある
- [ ] 当月行がハイライトされる
- [ ] 各月から「かんたん入力」「詳細」へ遷移できる
- [ ] 失敗時に toast が出る

## Definition of Done

- [ ] PR 作成＆レビュー完了
- [ ] 手動テスト手順を PR に記載（年切替/フィルタ/遷移）
- [ ] lint/typecheck が通る

---

## Dependencies

- B5（MonthlyRepository 実装）
- A5（フォーマットユーティリティ）※任意だが推奨

## Follow-ups（関連チケット）

- E2. 行アクション（複製/削除/メニュー）追加
- E3. 月次かんたん入力（保存）
- E10. 月次削除
