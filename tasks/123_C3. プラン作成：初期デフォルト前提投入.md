# Jira チケット（C3）プラン作成：初期デフォルト前提投入（3 シナリオ、住宅 4 タイプ）

## Summary

C3. プラン作成：初期デフォルト前提投入（3 シナリオ、住宅 4 タイプの初期前提）

## Issue Type

Story（または Task）

## Priority

High

## Background / Context

C2（プラン作成ウィザード）で Plan / 初期 Version（v1）を作成した直後に、  
MVP の主要画面（ダッシュボード・住宅 LCC 比較・前提編集・将来見通し）を“空にならず”動かすため、  
**Version 配下の前提データ**を初期投入する必要がある。

- シナリオ：保守/標準/楽観（3 件）
- 住宅前提：高性能住宅/一般戸建/分譲マンション/賃貸（4 件）
- これらはユーザーが後で編集可能であることが前提（概算・仮定）

※住宅タイプのキーは `high_performance_home`（表示名：高性能住宅）に統一する。

## Goal

- 新規プラン作成時に「初期 Version」に対して必須の前提データが自動投入される
- 住宅 LCC 比較トップで、4 タイプが即時に比較表示できる（少なくとも数値が出る/プレースホルダが整う）
- 前提編集画面で、かんたん/詳細の初期値が表示される
- ウィザードで選択した住宅タイプが `isSelected=true` になる

---

## In Scope

- 初期データ投入ロジックの実装（UseCase/Service 関数）
- Repo 呼び出し（ScenarioAssumptions/HousingAssumptions の作成）
- 住宅タイプ選択状態（isSelected）の反映
- “初期値の根拠/注意”のコメント化（過度に固定しない、後で編集できる前提）

## Out of Scope

- LCC 計算ロジックの実装（G9）
- 住宅前提編集 UI の実装（G5〜）
- 税・制度の厳密モデル（MVP 外）
- 地域/個別条件の自動推定

---

## Deliverables

- `src/lib/usecases/initializePlanVersion.ts`（例）：
  - `initializePlanVersionDefaults({ planId, planVersionId, selectedHousingType })`
- 初期投入されるデータ仕様（docs/コメント）：
  - scenario defaults（3 件）
  - housing defaults（4 件 + type_specific 雛形）
- Repo への保存が 1 回のトランザクションで行える場合は tx 化（可能なら推奨）

---

## Default Values（初期デフォルト前提案）

> **数値は仮定**。MVP では「編集できること」が重要。  
> まずは “標準（base）に近い” ざっくり値を入れ、詳細はユーザーが調整できるようにする。

### A) シナリオ前提（ScenarioAssumptions）

- 目的：ダッシュボード/将来見通し/住宅 LCC の比較で最低限の差が出ること

| scenarioKey          | 昇給率 wageGrowthRate | インフレ率 inflationRate | 資産利回り investmentReturnRate |
| -------------------- | --------------------: | -----------------------: | ------------------------------: |
| conservative（保守） |                  0.01 |                     0.01 |                            0.01 |
| base（標準）         |                  0.02 |                     0.02 |                            0.03 |
| optimistic（楽観）   |                  0.03 |                     0.02 |                            0.05 |

※この値は UI で必ず編集可能。

### B) 住宅前提（HousingAssumptions：4 タイプ）

共通方針：

- **初期は「入力がなくても比較画面が成立」** する程度の仮値または 0/未設定を許容
- ユーザー入力が無い場合でも、前提編集へ誘導できるようにする
- 光熱費の差は「係数（utilitiesFactor）」で表現（後で変更可）

#### housingType キー（固定）

- `high_performance_home`（表示：高性能住宅）
- `detached`（表示：一般戸建）
- `condo`（表示：分譲マンション）
- `rent`（表示：賃貸）

#### 初期投入（共通項目）

- `repaymentType`：`annuity`（元利均等）
- `loanTermMonths`：420（35 年）※MVP の初期基準
- `loanInterestRate`：0.012（1.2%）※標準の仮置き
- `utilitiesBaseMonthlyYen`：20000（仮）※標準
- `propertyTaxAnnualYen`：120000（仮）※購入系のみ（rent は未設定/0）

#### utilitiesFactor（仮の差分）

- 高性能住宅：0.85（光熱費が低めになる仮定）
- 一般戸建：1.00
- 分譲マンション：0.95
- 賃貸：1.00

#### typeSpecific（雛形：最低限）

- 高性能住宅 / 一般戸建（DetachedTypeSpecific）
  - repairs（修繕スケジュール雛形）
    - 15 年：1,200,000 円
    - 30 年：2,500,000 円
- 分譲マンション（CondoTypeSpecific）
  - 管理費：18,000 円/月
  - 修繕積立：12,000 円/月
  - 駐車場：0 円/月（任意）
  - 一時金：空配列
- 賃貸（RentTypeSpecific）
  - 家賃：130,000 円/月
  - 家賃上昇率：0.01
  - 更新料：130,000 円
  - 更新周期：2 年
  - 引越費用：300,000 円

> これらは「おすすめ」ではなく、**比較が動くための初期値**。必ず編集可能にする。

### C) 選択中住宅タイプ（isSelected）

- C2 ウィザードで選択された住宅タイプのみ `isSelected=true`
- 残り 3 タイプは `false`

### D) ライフイベント

- 初期投入は **0 件**（ユーザーが追加する）

---

## Functional Requirements（実装要件）

- `initializePlanVersionDefaults()` は以下を満たすこと
  1. 対象 `planVersionId` に対し、ScenarioAssumptions を 3 件作成（存在する場合は上書きしない or replace 方針を決める）
  2. 対象 `planVersionId` に対し、HousingAssumptions を 4 件作成
  3. `selectedHousingType` を `isSelected=true` にし、他を false
  4. 可能なら 1 トランザクション（複数 store）で整合性を担保
- 冪等性（推奨）
  - 同一 version に対し 2 回呼ばれても壊れない（既存チェック or replace）
  - MVP では「既にあればスキップ」でも OK（方針を明記）

---

## Acceptance Criteria

- [ ] 新規プラン作成後、初期 Version に 3 シナリオが存在する
- [ ] 新規プラン作成後、初期 Version に住宅 4 タイプの前提が存在する
- [ ] 選択した住宅タイプが `isSelected=true` で保存されている
- [ ] 住宅 LCC 比較トップで 4 タイプのカードが成立する（値またはプレースホルダが出る）
- [ ] 住宅前提編集で初期値が表示される（かんたん/詳細の出発点になる）
- [ ] 失敗時に不整合が残りにくい（可能なら tx、少なくとも例外を throw）

## Definition of Done

- [ ] PR 作成＆レビュー完了
- [ ] 手動テスト手順が PR に記載（作成 →LCC 比較 → 前提編集 → 選択反映）
- [ ] lint/typecheck が通る

---

## Dependencies

- B1（ドメイン型）
- B5（Repo 実装：Scenario/Housing/Version 関連）
- C2（プラン作成フローから呼び出す）

## Follow-ups（関連チケット）

- G5〜G7：住宅前提編集 UI（preset 適用など）
- G9：LCC 計算（初期値が計算に使われる）
- I2：将来見通し概算（シナリオ前提が使われる）
