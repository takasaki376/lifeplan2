# Jira チケット C3: プラン作成：初期デフォルト前提投入（シナリオ/住宅 4 タイプ）

## Summary

C3. プラン作成：初期デフォルト前提投入（シナリオ/住宅 4 タイプ）

## Issue Type

Story / Task

## Priority

High

## Background / Context

C2（プラン作成ウィザード）で Plan / 初期 Version（v1）を作成した直後に、
MVP の主要画面（ダッシュボード/住宅 LCC 比較/前提編集）を空状態にしないため、
**Version 配下の前提データ**を初期投入する必要がある。

- シナリオ前提：保守/標準/楽観（3 件）
- 住宅前提：高性能住宅/一般戸建/分譲マンション/賃貸（4 件）
- C2 で選択された住宅タイプを `isSelected=true` にする

## Goal

- 新規プラン作成時に「初期 Version」へ前提データを投入できる
- 住宅 LCC 比較で 4 タイプが即表示できる
- 前提編集画面で初期値が表示される
- 選択住宅タイプが `isSelected=true` になる

---

## In Scope

- 初期投入ロジックの usecase 関数
  - 例: `initializePlanVersionDefaults({ planVersionId, selectedHousingType })`
- Repo 呼び出し
  - ScenarioAssumptions / HousingAssumptions の作成
  - 住宅タイプ選択状態の反映
- 可能なら 1 トランザクションで投入

## Out of Scope

- LCC 計算ロジック（G9）
- 住宅前提編集 UI（G5〜）
- 税制や地域条件の厳密化

---

## Deliverables

- `src/lib/usecases/initializePlanVersionDefaults.ts`
  - `initializePlanVersionDefaults({ planVersionId, selectedHousingType })`
- 初期投入データ仕様（doc/コメント）
  - scenario defaults 3 件
  - housing defaults 4 件 + typeSpecific 雛形

---

## Default Values（初期デフォルト案）

> 数値は仮値。MVP では「編集できること」が重要。
> まずは “標準（base）” に近い値を入れ、後で調整できる前提とする。

### A) シナリオ前提（ScenarioAssumptions）

| scenarioKey  | wageGrowthRate | inflationRate | investmentReturnRate |
| ------------ | -------------: | ------------: | -------------------: |
| conservative |           0.01 |          0.01 |                 0.01 |
| base         |           0.02 |          0.02 |                 0.03 |
| optimistic   |           0.03 |          0.02 |                 0.05 |

### B) 住宅前提（HousingAssumptions）

住宅タイプキー（固定）:

- `high_performance_home`（表示：高性能住宅）
- `detached`（表示：一般戸建）
- `condo`（表示：分譲マンション）
- `rent`（表示：賃貸）

共通方針:

- 初期は「入力がなくても比較画面が成り立つ」値または未設定を許容
- 住宅タイプの差は `utilitiesFactor` で表現

utilitiesFactor（仮）:

- 高性能住宅：0.85
- 一般戸建：1.00
- 分譲マンション：0.95
- 賃貸：1.00

typeSpecific 雛形（最低限）:

- 高性能住宅
  - repairsSchedule: 20 年 1,200,000 円 / 40 年 1,500,000 円
- 一般戸建
  - repairsSchedule: 10 年 1,500,000 円 / 20 年 1,500,000 円 / 30 年 2,500,000 円
- 分譲マンション
  - 管理費 18,000 円/月
  - 修繕積立 12,000 円/月
  - 駐車場：0 円/月（任意）
- 賃貸
  - 家賃 130,000 円/月
  - 更新料 130,000 円
  - 更新周期：2 年
  - 引越費 300,000 円

### C) 選択中住宅タイプ（isSelected）

- C2 で選択された住宅タイプのみ `isSelected=true`
- 残り 3 タイプは `false`

### D) ライフイベント

- 初期投入は 0 件

---

## Functional Requirements

- `initializePlanVersionDefaults()` は以下を満たす
  1. 指定 `planVersionId` に対し ScenarioAssumptions を 3 件作成
  2. 指定 `planVersionId` に対し HousingAssumptions を 4 件作成
  3. `selectedHousingType` のみ `isSelected=true`
  4. 可能なら 1 トランザクションで実行
- 冪等性を意識する（既存があればスキップでも OK）

---

## Acceptance Criteria

- [ ] 新規プラン作成後、初期 Version に 3 シナリオが存在する
- [ ] 新規プラン作成後、初期 Version に住宅 4 タイプ前提が存在する
- [ ] 選択した住宅タイプが `isSelected=true` で保存される
- [ ] 住宅 LCC 比較で 4 タイプのカードが成立する
- [ ] 失敗時に不整合が残りにくい（可能なら tx）

## Definition of Done

- [ ] PR 作成〜レビュー完了
- [ ] 手動テスト手順を PR に記載（作成 → LCC 比較 → 前提編集）
- [ ] lint/typecheck が通る

---

## Dependencies

- B1（ドメイン型）
- B5（Scenario/Housing/Version Repo）
- C2（プラン作成フローから呼び出す）

## Follow-ups / 関連チケット

- G5〜G7（住宅前提編集 UI）
- G9（LCC 計算）
- I2（将来見通し）
