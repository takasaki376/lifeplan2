# Jira チケット（G1）住宅 LCC 比較トップ：4 タイプの表示（Repo 連携）

## Summary

G1. 住宅 LCC 比較トップ：4 タイプの表示（Repo 連携）— 高性能住宅/一般戸建/分譲マンション/賃貸の比較カード表示

## Issue Type

Story（または Task）

## Priority

High（住宅 LCC 比較の入口）

## Background / Context

Knowledge で定義された住宅 LCC 比較（4 タイプ）を、前提編集とセットで運用できるようにする。比較トップは「4 タイプの並列表示」「選択中の明示」「内訳の見える化」を担い、前提編集へ誘導する。  
比較対象：高性能住宅 / 一般戸建 / 分譲マンション / 賃貸。  
内訳（最低限）：初期費用、ローン、税、修繕、光熱（＋マンション管理、賃貸更新など）。

## Goal

- `/plans/[planId]/housing` で 4 タイプを並列表示できる（Repo 連携）
- 現行 Version の `housingAssumptions` を取得し、isSelected を反映できる
- 各タイプの LCC 合計（概算）と内訳（最低限カテゴリ）を表示できる（G9 利用）
- 前提編集（かんたん/詳細）への導線がある
- 前提不足でも破綻せず、空状態/警告を表示できる

---

## In Scope

- 画面：住宅 LCC 比較トップ（v0 モックにデータを流し込む）
- Repo 連携：
  - `VersionRepo.getCurrent(planId)`
  - `HousingRepo.listByVersion(planVersionId)`（4 件取得）
- 4 タイプ表示（固定順推奨）：
  1. 高性能住宅（high_performance_home）
  2. 一般戸建（detached）
  3. 分譲マンション（condo）
  4. 賃貸（rent）
- isSelected の表示（選択中バッジ/強調）
- 表示項目（MVP 最小）：
  - 合計 LCC（概算）
  - 内訳（最低限カテゴリ）
    - 初期
    - ローン or 家賃
    - 税
    - 修繕 or 管理
    - 光熱
    - その他（更新料/引越等）
- CTA：
  - `前提を編集` → `/plans/[planId]/housing/assumptions`
  - `このタイプを選択`（任意：選択切替をここで行うなら HousingRepo.setSelected を呼ぶ）
- 空状態/前提不足の表示

## Out of Scope

- LCC 計算ロジック本体（G9 で実装）
- グラフ表示（年次推移/累積など）
- 売却/住替えの確率モデル（MVP では任意）
- 税の厳密計算（地域・控除完全対応）

---

## Functional Requirements

### 1) データ取得

- 初期化時に取得（並列で OK）：
  - `currentVersion = VersionRepo.getCurrent(planId)`
  - `housingList = HousingRepo.listByVersion(currentVersion.id)`
- currentVersion が無い場合：
  - 表示：`現行バージョンがありません`
  - CTA：`改定履歴へ` → `/plans/[planId]/versions`

### 2) 4 タイプの表示ルール

- 4 タイプ分のカードを常に表示（可能なら）
  - housingList に不足がある場合：不足分は「未設定」カードとして表示し、前提編集へ誘導
- type→ 表示名マップ：
  - high_performance_home：高性能住宅
  - detached：一般戸建
  - condo：分譲マンション
  - rent：賃貸

### 3) 選択状態の反映

- `isSelected=true` のカードを強調（枠/バッジ）
- 未選択の場合：
  - 上部に注意表示：`比較する住宅タイプが未選択です`
  - CTA：`前提を編集` or `このタイプを選択`（実装方針に応じて）

### 4) LCC 値の表示（G9 利用）

- 各カードで `calcLcc({ housingAssumptions, scenarioAssumptions?, horizonMonths })` を呼び、
  - `totalNominalYen`
  - `breakdownNominalYen`（最低限カテゴリ）
  - `warnings`
    を表示
- G9 が未実装の場合（MVP 保険）：
  - 合計：`—`
  - メッセージ：`前提を入力すると概算が表示されます`
  - CTA を強める（前提編集へ）

### 5) 前提不足/警告

- 計算結果の warnings がある場合：
  - カード内に小さく `前提不足（概算）` 表示（詳細はツールチップ/折りたたみでも OK）
- 数値表示は「概算」表記を必須（誤解防止）

### 6) 導線

- 画面上部：
  - `前提を編集` → `/plans/[planId]/housing/assumptions`
- （任意）カードアクション：
  - `詳細を見る` → `/plans/[planId]/housing/[type]`（将来拡張でも OK）

---

## UI Requirements

- v0 モック準拠（4 カード＋比較テーブルでも可）
- 金額は `formatYen`（A5）で整形
- ローディング：Skeleton
- エラー：Alert（画面全体 or カード単位）

---

## Technical Notes

- `"use client"`（IndexedDB）
- Repo：
  - `VersionRepo.getCurrent(planId)`
  - `HousingRepo.listByVersion(planVersionId)`
  - （任意）`HousingRepo.setSelected(planVersionId, type)`
- 計算：
  - G9 の `calcLcc()` を呼ぶ（なければプレースホルダ）
- 4 タイプ不足を検知して「未設定」カードを出す（C3 があれば基本は揃う）

---

## Acceptance Criteria

- [ ] `/plans/[planId]/housing` で 4 タイプが表示される（不足時も未設定カードで崩れない）
- [ ] 現行 Version の housingAssumptions を Repo から取得して反映される
- [ ] isSelected が UI に反映される（強調/バッジ）
- [ ] 各タイプで LCC 合計（概算）と内訳（最低限カテゴリ）が表示される（G9 連携）
- [ ] 前提不足時に警告/プレースホルダ表示となり、前提編集へ誘導できる
- [ ] `前提を編集` 導線が機能する
- [ ] ローディング/エラー表示がある
- [ ] lint/typecheck が通る

## Definition of Done

- [ ] PR 作成＆レビュー完了
- [ ] 手動テスト手順が PR に記載（4 タイプ揃い/不足/未選択/G9 未実装時）
- [ ] lint/typecheck が通る

---

## Dependencies

- B5（VersionRepo / HousingRepo）
- C3（初期前提投入：4 タイプ生成＋ selected）
- G9（LCC 計算モジュール）※未完の場合はプレースホルダ対応
- A5（formatYen 等：推奨）

## Follow-ups

- G5. 住宅前提編集（かんたん/詳細）への実装強化
- G4. 比較グラフ（累積/年次推移）
- D5. ダッシュボードの LCC サマリーカード（G1 の計算結果を流用）
